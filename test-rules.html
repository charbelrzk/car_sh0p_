<!DOCTYPE html>
<html>
<head>
    <title>Test Firestore Rules</title>
</head>
<body>
    <h1>Firestore Rules Test</h1>
    <div id="result"></div>
    <button onclick="testWrite()">Test Write Permission</button>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js';
        
        const config = {
            apiKey: "AIzaSyC87832Gxt03UlZOSbxoU46hkKqF-Pvpkc",
            authDomain: "car--shop.firebaseapp.com",
            projectId: "car--shop",
            storageBucket: "car--shop.firebasestorage.app",
            messagingSenderId: "385403019174",
            appId: "1:385403019174:web:c8a2c5a635d2bbbf0fb967",
            measurementId: "G-B9KZCXJVK9"
        };
        
        const app = initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app, 'cars-database');
        
        async function login() {
            try {
                const userCredential = await signInWithEmailAndPassword(auth, 'charbel04rk@gmail.com', 'charbel');
                document.getElementById('result').innerHTML += `<p>✅ Login successful: ${userCredential.user.uid}</p>`;
                return userCredential.user;
            } catch (error) {
                document.getElementById('result').innerHTML += `<p>❌ Login failed: ${error.message}</p>`;
                return null;
            }
        }
        
        async function testWrite() {
            const user = await login();
            if (!user) return;
            
            try {
                const testData = {
                    name: 'Test Car',
                    price: 25000,
                    createdAt: serverTimestamp()
                };
                
                const docRef = await addDoc(collection(db, 'cars'), testData);
                document.getElementById('result').innerHTML += `<p>✅ Write successful! Document ID: ${docRef.id}</p>`;
            } catch (error) {
                document.getElementById('result').innerHTML += `<p>❌ Write failed: ${error.message}</p>`;
                document.getElementById('result').innerHTML += `<p>Error code: ${error.code}</p>`;
            }
        }
        
        // Auto-login on page load
        login();
    </script>
</body>
</html>
